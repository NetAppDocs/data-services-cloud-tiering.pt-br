---
sidebar: sidebar 
permalink: task-tiering-onprem-azure.html 
keywords: data tiering, fabricpool, cloud tiering, tiering cold data, tiering inactive data, tiering aff, tiering fas, tiering ontap, tiering volumes, tier data, tier cold data, tier fas, tier aff, tier ontap, azure, blob, azure blob 
summary: Libere espaço em seus clusters ONTAP locais hierarquizando dados inativos no armazenamento de Blobs do Azure. 
---
= Dados em camadas de clusters ONTAP locais para armazenamento de Blobs do Azure no NetApp Cloud Tiering
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./media/


[role="lead"]
Libere espaço em seus clusters ONTAP locais hierarquizando dados inativos no armazenamento de Blobs do Azure.  Libere espaço em seus clusters ONTAP locais hierarquizando dados inativos no armazenamento de Blobs do Azure.



== Início rápido

Comece rapidamente seguindo estas etapas ou role para baixo até as seções restantes para obter detalhes completos.

.image:https://raw.githubusercontent.com/NetAppDocs/common/main/media/number-1.png["Um"]Preparar para hierarquizar dados no armazenamento de Blobs do Azure
[role="quick-margin-para"]
Você precisa do seguinte:

[role="quick-margin-list"]
* Um cluster ONTAP local de origem executando o ONTAP 9.4 ou posterior que você adicionou ao NetApp Console e uma conexão HTTPS com o armazenamento de Blobs do Azure. https://docs.netapp.com/us-en/bluexp-ontap-onprem/task-discovering-ontap.html["Aprenda como descobrir um cluster"^] .
* Um agente do Console instalado em uma VNet do Azure ou em suas instalações.
* Rede para um agente que permite uma conexão HTTPS de saída para o cluster ONTAP no seu data center, para o armazenamento do Azure e para o serviço Cloud Tiering.


.image:https://raw.githubusercontent.com/NetAppDocs/common/main/media/number-2.png["Dois"]Configurar níveis
[role="quick-margin-para"]
No NetApp Console, selecione um sistema ONTAP local, selecione *Habilitar* para o serviço de Hierarquia e siga as instruções para hierarquizar dados no armazenamento de Blobs do Azure.

.image:https://raw.githubusercontent.com/NetAppDocs/common/main/media/number-3.png["Três"]Configurar licenciamento
[role="quick-margin-para"]
Após o término do seu teste gratuito, pague pelo Cloud Tiering por meio de uma assinatura pré-paga, uma licença BYOL do ONTAP Cloud Tiering ou uma combinação de ambos:

[role="quick-margin-list"]
* Para assinar no Azure Marketplace, https://azuremarketplace.microsoft.com/en-us/marketplace/apps/netapp.cloud-manager?tab=Overview["vá para a oferta do Marketplace"^] , selecione *Inscrever-se* e siga as instruções.
* Para pagar usando uma licença BYOL do Cloud Tiering, envie um e-mail para:ng-cloud-tiering@netapp.com?subject=Licensing[entre em contato conosco se precisar comprar uma] e, em seguida,link:https://docs.netapp.com/us-en/bluexp-digital-wallet/task-manage-data-services-licenses.html["adicione-o ao NetApp Console"] .




== Requisitos

Verifique o suporte para seu cluster ONTAP , configure sua rede e prepare seu armazenamento de objetos.

A imagem a seguir mostra cada componente e as conexões que você precisa preparar entre eles:

image:diagram_cloud_tiering_azure.png["Uma imagem de arquitetura que mostra o serviço Cloud Tiering com uma conexão ao agente do Console no seu provedor de nuvem, o agente com uma conexão ao seu cluster ONTAP e uma conexão entre o cluster ONTAP e o armazenamento de objetos no seu provedor de nuvem.  Os dados ativos residem no cluster ONTAP , enquanto os dados inativos residem no armazenamento de objetos."]


NOTE: A comunicação entre o agente do Console e o armazenamento de Blobs é somente para configuração do armazenamento de objetos.  O agente pode residir em suas instalações, em vez de na nuvem.



=== Prepare seus clusters ONTAP

Seus clusters ONTAP devem atender aos seguintes requisitos ao hierarquizar dados no armazenamento de Blobs do Azure.

Plataformas ONTAP suportadas::
+
--
* Ao usar o ONTAP 9.8 e posterior: você pode hierarquizar dados de sistemas AFF ou sistemas FAS com agregados totalmente SSD ou totalmente HDD.
* Ao usar o ONTAP 9.7 e versões anteriores: você pode hierarquizar dados de sistemas AFF ou sistemas FAS com agregados totalmente SSD.


--
Versão ONTAP suportada:: ONTAP 9.4 ou posterior
Requisitos de rede do cluster::
+
--
* O cluster ONTAP inicia uma conexão HTTPS pela porta 443 para o armazenamento de Blobs do Azure.
+
ONTAP lê e grava dados de e para armazenamento de objetos.  O armazenamento de objetos nunca inicia, ele apenas responde.

+
Embora o ExpressRoute ofereça melhor desempenho e menores custos de transferência de dados, ele não é necessário entre o cluster ONTAP e o armazenamento de Blobs do Azure.  Mas fazer isso é a melhor prática recomendada.

* É necessária uma conexão de entrada do agente, que pode residir em uma VNet do Azure ou em suas instalações.
+
Não é necessária uma conexão entre o cluster e o serviço Cloud Tiering.

* Um LIF intercluster é necessário em cada nó ONTAP que hospeda os volumes que você deseja hierarquizar.  O LIF deve ser associado ao _IPspace_ que o ONTAP deve usar para se conectar ao armazenamento de objetos.
+
Ao configurar o armazenamento em camadas de dados, o Cloud Tiering solicita o IPspace a ser usado.  Você deve escolher o IPspace ao qual cada LIF está associado.  Pode ser o IPspace "padrão" ou um IPspace personalizado que você criou.  Saiba mais sobre https://docs.netapp.com/us-en/ontap/networking/create_a_lif.html["LIFs"^] e https://docs.netapp.com/us-en/ontap/networking/standard_properties_of_ipspaces.html["Espaços IP"^] .



--
Volumes e agregados suportados:: O número total de volumes que o Cloud Tiering pode hierarquizar pode ser menor que o número de volumes no seu sistema ONTAP .  Isso ocorre porque os volumes não podem ser hierarquizados a partir de alguns agregados.  Consulte a documentação do ONTAP para https://docs.netapp.com/us-en/ontap/fabricpool/requirements-concept.html#functionality-or-features-not-supported-by-fabricpool["funcionalidade ou recursos não suportados pelo FabricPool"^] .



NOTE: O Cloud Tiering oferece suporte a volumes FlexGroup , a partir do ONTAP 9.5.  A configuração funciona da mesma forma que qualquer outro volume.



=== Descubra um cluster ONTAP

Você precisa adicionar um sistema ONTAP local ao NetApp Console antes de começar a hierarquizar dados frios.

https://docs.netapp.com/us-en/bluexp-ontap-onprem/task-discovering-ontap.html["Aprenda como descobrir um cluster"^].



=== Criar ou trocar agentes

É necessário um agente para hierarquizar dados na nuvem.  Ao hierarquizar dados no armazenamento de Blobs do Azure, você pode usar um agente que esteja em uma VNet do Azure ou em suas instalações.  Você precisará criar um novo agente e garantir que o agente selecionado atualmente resida no Azure ou no local.

* https://docs.netapp.com/us-en/bluexp-setup-admin/concept-connectors.html["Saiba mais sobre agentes"^]
* https://docs.netapp.com/us-en/bluexp-setup-admin/task-quick-start-connector-azure.html["Implantando um agente no Azure"^]
* https://docs.netapp.com/us-en/bluexp-setup-admin/task-quick-start-connector-on-prem.html["Instalando um agente em um host Linux"^]




=== Verifique se você tem as permissões de agente necessárias

Se você criou o agente do Console usando a versão 3.9.25 ou superior, está tudo pronto.  A função personalizada que fornece as permissões que um agente precisa para gerenciar recursos e processos dentro da sua rede do Azure será configurada por padrão.  Veja o https://docs.netapp.com/us-en/bluexp-setup-admin/reference-permissions-azure.html#custom-role-permissions["permissões de função personalizadas necessárias"^] e o https://docs.netapp.com/us-en/bluexp-setup-admin/reference-permissions-azure.html#cloud-tiering["permissões específicas necessárias para Cloud Tiering"^] .

Se você criou o agente usando uma versão anterior, precisará editar a lista de permissões da conta do Azure para adicionar quaisquer permissões ausentes.



=== Preparar a rede para o agente do Console

Certifique-se de que o agente do Console tenha as conexões de rede necessárias.  O agente pode ser instalado no local ou no Azure.

.Passos
. Certifique-se de que a rede onde o agente está instalado habilite as seguintes conexões:
+
** Uma conexão HTTPS pela porta 443 para o serviço Cloud Tiering e para o armazenamento de objetos do Azure Blob(https://docs.netapp.com/us-en/bluexp-setup-admin/task-set-up-networking-azure.html#endpoints-contacted-for-day-to-day-operations["veja a lista de pontos de extremidade"^] )
** Uma conexão HTTPS pela porta 443 para seu LIF de gerenciamento de cluster ONTAP


. Se necessário, habilite um ponto de extremidade de serviço VNet para o armazenamento do Azure.
+
Um ponto de extremidade de serviço de VNet para armazenamento do Azure é recomendado se você tiver uma conexão ExpressRoute ou VPN do seu cluster ONTAP para a VNet e quiser que a comunicação entre o agente e o armazenamento de Blobs permaneça na sua rede privada virtual.





=== Preparar o armazenamento de Blobs do Azure

Ao configurar o armazenamento em camadas, você precisa identificar o grupo de recursos que deseja usar, a conta de armazenamento e o contêiner do Azure que pertencem ao grupo de recursos.  Uma conta de armazenamento permite que o Cloud Tiering autentique e acesse o contêiner Blob usado para hierarquização de dados.

O Cloud Tiering oferece suporte ao escalonamento para qualquer conta de armazenamento em qualquer região que possa ser acessada por meio do agente.

O Cloud Tiering oferece suporte apenas aos tipos de contas de armazenamento General Purpose v2 e Premium Block Blob.


NOTE: Se você estiver planejando configurar o Cloud Tiering para usar uma camada de acesso de custo mais baixo para onde seus dados em camadas farão a transição após um determinado número de dias, não selecione nenhuma regra de ciclo de vida ao configurar o contêiner na sua conta do Azure.  O Cloud Tiering gerencia as transições do ciclo de vida.



== Camada de dados inativos do seu primeiro cluster para o armazenamento de Blobs do Azure

Depois de preparar seu ambiente do Azure, comece a hierarquizar os dados inativos do seu primeiro cluster.

.O que você vai precisar
https://docs.netapp.com/us-en/bluexp-ontap-onprem/task-discovering-ontap.html["Um sistema ONTAP local para o NetApp Console"^].

.Passos
. Selecione o sistema ONTAP local.
. Clique em *Ativar* para o serviço de camadas no painel direito.
+
Se o destino de camadas do Azure Blob existir como um sistema na página Sistemas, você poderá arrastar o cluster para o sistema Azure Blob para iniciar o assistente de configuração.

+
image:screenshot_setup_tiering_onprem.png["Uma captura de tela que mostra a opção Ativar que aparece no lado direito da tela depois que você seleciona um sistema ONTAP local."]

. *Definir nome do armazenamento de objetos*: insira um nome para este armazenamento de objetos.  Ele deve ser exclusivo de qualquer outro armazenamento de objetos que você possa estar usando com agregados neste cluster.
. *Selecionar Provedor*: Selecione *Microsoft Azure* e selecione *Continuar*.
. *Selecionar Provedor*: Selecione *Microsoft Azure* e selecione *Continuar*.
. Conclua as etapas nas páginas *Criar armazenamento de objetos*:
+
.. *Grupo de recursos*: selecione um grupo de recursos onde um contêiner existente é gerenciado ou onde você gostaria de criar um novo contêiner para dados em camadas e selecione *Continuar*.
.. *Grupo de recursos*: selecione um grupo de recursos onde um contêiner existente é gerenciado ou onde você gostaria de criar um novo contêiner para dados em camadas e selecione *Continuar*.
+
Ao usar um agente local, você deve inserir a Assinatura do Azure que fornece acesso ao grupo de recursos.

.. *Contêiner do Azure*: selecione o botão de opção para adicionar um novo contêiner de Blobs a uma conta de armazenamento ou usar um contêiner existente.  Em seguida, selecione a conta de armazenamento e escolha o contêiner existente ou insira o nome do novo contêiner.  Em seguida, selecione *Continuar*.
.. *Contêiner do Azure*: selecione o botão de opção para adicionar um novo contêiner de Blobs a uma conta de armazenamento ou usar um contêiner existente.  Em seguida, selecione a conta de armazenamento e escolha o contêiner existente ou insira o nome do novo contêiner.  Em seguida, selecione *Continuar*.
+
As contas de armazenamento e contêineres que aparecem nesta etapa pertencem ao grupo de recursos que você selecionou na etapa anterior.

.. *Ciclo de vida da camada de acesso*: o Cloud Tiering gerencia as transições do ciclo de vida dos seus dados em camadas.  Os dados começam na classe _Hot_, mas você pode criar uma regra para aplicar a classe _Cool_ aos dados após um determinado número de dias.
+
Selecione o nível de acesso para o qual você deseja fazer a transição dos dados em camadas e o número de dias antes que os dados sejam atribuídos a esse nível e selecione *Continuar*.  Por exemplo, a captura de tela abaixo mostra que dados em camadas são atribuídos à classe _Cool_ da classe _Hot_ após 45 dias no armazenamento de objetos.

+
Se você escolher *Manter dados nesta camada de acesso*, os dados permanecerão na camada de acesso _Quente_ e nenhuma regra será aplicada. link:reference-azure-support.html["Veja os níveis de acesso suportados"^] .

+
image:screenshot_tiering_lifecycle_selection_azure.png["Uma captura de tela mostrando como selecionar outro nível de acesso que será atribuído aos seus dados após um certo número de dias."]

+
Observe que a regra do ciclo de vida é aplicada a todos os contêineres de blobs na conta de armazenamento selecionada.

.. *Rede de cluster*: Selecione o IPspace que o ONTAP deve usar para se conectar ao armazenamento de objetos e selecione *Continuar*.
+
Selecionar o IPspace correto garante que o Cloud Tiering possa configurar uma conexão do ONTAP para o armazenamento de objetos do seu provedor de nuvem.

+
Você também pode definir a largura de banda de rede disponível para carregar dados inativos no armazenamento de objetos definindo a "Taxa máxima de transferência".  Selecione o botão de opção *Limitado* e insira a largura de banda máxima que pode ser usada ou selecione *Ilimitado* para indicar que não há limite.



. Na página _Volumes em camadas_, selecione os volumes para os quais você deseja configurar o escalonamento e inicie a página Política de escalonamento:
+
** Para selecionar todos os volumes, marque a caixa na linha de título (image:button_backup_all_volumes.png[""] ) e selecione *Configurar volumes*.
** Para selecionar vários volumes, marque a caixa para cada volume (image:button_backup_1_volume.png[""] ) e selecione *Configurar volumes*.
** Para selecionar um único volume, selecione a linha (ouimage:screenshot_edit_icon.gif["ícone de lápis de edição"] ícone) para o volume.
+
image:screenshot_tiering_initial_volumes.png["Uma captura de tela que mostra como selecionar um único volume, vários volumes ou todos os volumes, e o botão modificar volumes selecionados."]



. Na caixa de diálogo _Política de níveis_, selecione uma política de níveis, ajuste opcionalmente os dias de resfriamento para os volumes selecionados e selecione *Aplicar*.
+
link:concept-cloud-tiering.html#volume-tiering-policies["Saiba mais sobre políticas de níveis de volume e dias de resfriamento"].

+
image:screenshot_tiering_initial_policy_settings.png["Uma captura de tela que mostra as configurações de política de camadas configuráveis."]



.Resultado
Você configurou com sucesso a hierarquização de dados de volumes no cluster para o armazenamento de objetos do Azure Blob.

.O que vem a seguir?
link:task-licensing-cloud-tiering.html["Não se esqueça de assinar o serviço Cloud Tiering"].

Você pode revisar informações sobre os dados ativos e inativos no cluster. link:task-managing-tiering.html["Saiba mais sobre como gerenciar suas configurações de níveis"] .

Você também pode criar armazenamento de objetos adicional nos casos em que deseja hierarquizar dados de determinados agregados em um cluster para diferentes armazenamentos de objetos.  Ou se você planeja usar o FabricPool Mirroring, onde seus dados em camadas são replicados para um armazenamento de objetos adicional. link:task-managing-object-storage.html["Saiba mais sobre como gerenciar armazenamentos de objetos"] .
